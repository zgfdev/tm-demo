# 配置谷歌Optimize服务端实验(A/B测试)说明文档

## 一、谷歌优化工具(Optimize)中的配置

1. 在优化工具中创建实验(类型为A/B测试)
2. 设定实验目标
3. 设置实验定位
4. 创建变体，获取变体数量（同地址的页面有多少个不同的版本，则创建多少个实验变体）
5. 启动实验
6. 获取实验ID

---

## 二、网站中的配置

### 基本实验逻辑逻辑说明

- 所有实验用户请求同一地址，给不同实验用户分配不同的页面内容（版本），首次分配后同一用户获得的版本保持不变
- 和普通的optimize实验（UI界面可以进行流量分配设置和不同变体的权重占比设置）不同，服务端optimize实验需要自行实现这样的分配
- 建议将所有网站用户纳入服务端实验范围，且将不同的实验变体（版本）在所有实验用户间平均分配（普通实验UI界面的默认设定）
- 每一实验用户获取到分配给他的实验版本，GA在发送事件衡量请求时将携带实验ID和实验变体ID（如变体数量为4，则变体ID为0、1、2、3，以此类推）
- 如何实现在所有实验用户间平均分配实验变体ID并在之后保持该用户取得同一ID、获得同一版本内容？

    - 新建cookie方式，随机生成实验变体ID后，将该ID存到cookie
    - 借助已有cookie方式，GA用户识别用户的Client ID（cid）可在键名为_ga的cookie中取得，取得后通过哈希方式将每一cid映射为一特定实验变体ID
    - 特定情况下如果无法先获取到cid，还是需要先随机生成变体ID并将该ID和用户绑定（如在cookie中存储变体ID值）

### 变体分配方式1

服务端根据用户cid分配变体ID，服务端根据变体ID直接返回不同版本网页，详见/demo/optimize/be实现。

### 变体分配方式2

客户端先分配变体ID，并将变体ID存储到cookie，发送携带变体ID的请求给服务端，服务端根据变体ID返回不同版本网页，详见/demo/optimize/fe实现。

---

## 官方文档链接

- [服务器端实验](https://developers.google.com/optimize/devguides/experiments)
